@import sirius.biz.codelists.*
@args CodeList codeList, Page entries
@extends(view.codelists.code-list.html, page: "entries")

@tableSearchHeader(entries, ("code-list/" + codeList.getId())) {
    <a class="btn btn-primary" href="#" onclick="createEntry()">@i18n("Model.create")</a>
}


<table class="table table-striped">
    <thead>
        <tr>
            <th>
                @i18n("CodeListEntry.code")<br>
                <small class="muted">@i18n("Model.priority")</small>
            </th>
            <th>
                @i18n("CodeListEntry.value")<br>
                <small class="muted">@i18n("CodeListEntry.additionalValue")</small>
            </th>
            <th>
                @i18n("Model.description")
            </th>
            <th class="col-md-2" />
        </tr>
    </thead>
    <tbody>
        @for(CodeListEntry entry : entries.getItems()) {
            <tr>
                <td>
                    <a href="#" onclick="editEntry('@entry.getCode().escapeString()', '@entry.getValue().escapeString()', '@entry.getAdditionalValue().escapeString()', '@entry.getDescription().escapeString()', @entry.getPriority())">@entry.getCode()</a><br />
                    <small class="muted">@entry.getPriority()</small>
                </td>
                <td>
                    @entry.getValue()<br />
                    <small class="muted">@entry.getAdditionalValue()</small>
                </td>
                <td>
                    @entry.getDescription()
                </td>
                <td class="col-md-2 align-center">
                    @deleteLink(("code-list/ " +codeList.getId() + "/delete-entry/" + entry.getId() + "?" + entries.createQueryString()))
                </td>
            </tr>
        }
    </tbody>
</table>

@pagination(entries, ("code-list" + codeList.getId()))

<script type="text/javascript">

    function createEntry() {
        $('#code').val('');
        $('#value').val('');
        $('#additionalValue').val('');
        $('#description').val('');
        $('#priority').val('');
        $('#dlgMessageBox').hide();

        $('#editEntry').modal('show');
        $('#code').focus();
    }

    function editEntry(code, value, additionalValue, description, priority) {
        $('#code').val(code);
        $('#value').val(value);
        $('#additionalValue').val(additionalValue);
        $('#description').val(description);
        $('#priority').val(priority);
        $('#dlgMessageBox').hide();

        $('#editEntry').modal('show');
        $('#code').focus();
    }

    function updateEntry() {
        if ($('#code').val() == '') {
            $('#dlgMessageBox .alert').text('@i18n("CodeListController.codeMustBeFilled")');
            $('#dlgMessageBox').show();
        } else {
            $('#entryForm').submit();
        }
    }

</script>

@modal(name: "editEntry", labelKey: "CodeListEntry") {
    @modalBody() {
        <div id="dlgMessageBox" style="display: none">
            <div class="alert alert-danger"></div>
        </div>
        <fieldset>
            <label>@i18n("CodeListEntry.code")</label>
            <input type="text" name="code" id="code" class="input-block-level" />
            <label>@i18n("CodeListEntry.value")</label>
            <input type="text" name="value" id="value" class="input-block-level" />
            <label>@i18n("CodeListEntry.additionalValue")</label>
            <input type="text" name="additionalValue" id="additionalValue" class="input-block-level" />
            <label>@i18n("Model.priority")</label>
            <input type="text" name="priority" id="priority" class="input-block-level" />
            <label>@i18n("Model.description")</label>
            <input type="text" name="description" id="description" class="input-block-level" />
        </fieldset>
    }

    @modalFooter(cancelKey: "NLS.cancel") {
        <a onclick="updateEntry()" class="btn btn-primary"><i class="icon-ok"></i> @i18n("NLS.save")</a>
    }
}